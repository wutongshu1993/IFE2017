{"version":3,"sources":["vueObserve.js"],"names":[],"mappings":"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","file":"vueObserve-compiled.js","sourcesContent":["/**\r\n * Created by lh on 2017/3/6.\r\n */\r\nfunction Observer(data) {\r\n    this.data = data;\r\n    this.walk(data);\r\n    this.eventBus = new PubSub();\r\n}\r\nvar p = Observer.prototype;\r\np.walk = function (obj) {\r\n\r\n    console.log(this);\r\n    var val;\r\n    for(var key in obj){//这里需要进行深度递归对每个属性都进行监听\r\n        // console.log(key);\r\n\r\n        if(typeof obj[key] === 'object'){/////为啥这样不起作用呢\r\n            this.walk(obj[key]);\r\n        }\r\n\r\n\r\n        if(obj.hasOwnProperty(key)){\r\n         val = obj[key];\r\n         if(typeof val === 'object'){\r\n             new Observer(val);\r\n         }\r\n            this.convert(key, val);//依次给所有属性设置get和set函数。\r\n        }\r\n    }\r\n};\r\np.convert = function (key, val) {\r\n    var self = this;\r\n    Object.defineProperty(this.data, key, {\r\n        enumerable: true,\r\n        configurable: true,\r\n        get: function () {\r\n            console.log(\"你访问了\"+ key);\r\n            return val;\r\n        },\r\n        set : function (newVal) {//如果是在data下的address的city进行设置，这里的emit不会起作用。\r\n            console.log(\"你设置了\"+key+' = '+newVal );\r\n            if(newVal === val){return };\r\n            self.eventBus.emit(key, val, newVal);//执行函数\r\n            val = newVal;\r\n            if(typeof newVal === 'object'){\r\n                new Observer(newVal);//如果新设置的值为对象，为新对象绑定。\r\n            }\r\n        }\r\n    })\r\n};\r\np.$watch = function (attr, callback) {\r\nthis.eventBus.on(attr, callback);\r\n};\r\n\r\nfunction PubSub() {\r\n    this.handlers = {};\r\n}\r\nPubSub.prototype = {\r\n    on : function (eventType, handler) {\r\n        var self = this;\r\n        if(!(eventType in self.handlers)) {\r\n            self.handlers[eventType] = [];\r\n        }\r\n        self.handlers[eventType].push(handler);\r\n        return this;\r\n    },\r\n    emit : function (attr, val, newVal) {//执行已经注册的函数，函数在set的时候调用emit。在watch中进行绑定\r\n        var self = this;\r\n        if(self.handlers[attr]){\r\n            self.handlers[attr].forEach(function (item) {\r\n                item(val, newVal);\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nvar app2 = new Observer({\r\n    major: 'computer',\r\n    address:{\r\n        country: 'china',\r\n        city : 'chengdu'\r\n    }\r\n});\r\n\r\n\r\napp2.$watch('city', function () {\r\n   console.log('city发生改变了')\r\n});\r\napp2.data.address.city= 'dl';\r\n// console.log(app2.data.address.city);\r\n\r\n\r\n\r\n"]}